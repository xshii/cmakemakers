# ============================================================================
# CMakeMakers 完整示例配置
# ============================================================================
# 本文件展示了 CMakeMakers 支持的所有配置选项和典型使用场景
#
# 场景说明：
# 这是一个包含多个 target 的复杂项目示例：
# - core: 核心静态库
# - utils: 工具共享库
# - app: 主应用程序（依赖 core 和 utils）
# - tests: 测试程序
# ============================================================================

# ----------------------------------------------------------------------------
# 项目基本信息
# ----------------------------------------------------------------------------
project:
  name: CompleteExample                 # 项目名称
  version: 2.1.3                        # 语义化版本号
  cmake_minimum_required: "3.20"        # CMake 最低版本（推荐 3.15+）
  languages:                            # 编程语言列表
    - C                                 # C 语言
    - CXX                               # C++
  description: "Complete CMakeMakers feature demonstration"
  homepage_url: "https://github.com/example/project"  # 项目主页（可选）

# ----------------------------------------------------------------------------
# 全局配置 - 应用于所有 target
# ----------------------------------------------------------------------------
global:
  # C++ 标准设置
  cxx_standard: 20                      # C++ 标准 (11, 14, 17, 20, 23)
  cxx_standard_required: true           # 严格要求，不允许降级
  cxx_extensions: false                 # 禁用编译器扩展（推荐 false）

  # 构建类型
  default_build_type: RelWithDebInfo    # Debug, Release, RelWithDebInfo, MinSizeRel

  # 全局变量（可在 CMakeLists.txt 中使用）
  variables:
    - name: ENABLE_TESTING
      value: "ON"
      cache: true                       # 添加到 CMake cache
      type: BOOL                        # BOOL, STRING, PATH, FILEPATH
      description: "Enable unit testing"

    - name: INSTALL_PREFIX
      value: "/usr/local"
      cache: true
      type: PATH

  # 全局选项（用户可配置）
  options:
    - name: BUILD_SHARED_LIBS
      value: false
      description: "Build shared libraries by default"

    - name: ENABLE_IPO
      value: true
      description: "Enable interprocedural optimization"

# ----------------------------------------------------------------------------
# Target 1: core - 核心静态库
# ----------------------------------------------------------------------------
targets:
  # ========== 静态库示例 ==========
  - name: core
    type: static_library

    # 源文件：多种方式组合
    sources:
      # Glob 模式 - 推荐用于大型项目
      - type: glob
        pattern: src/core/**/*.cpp      # 递归匹配
        recursive: true
        configure_depends: true         # CMake 3.12+，文件变化时自动重新配置
        exclude:
          - "**/*_test.cpp"             # 排除测试
          - "**/*_bench.cpp"            # 排除性能测试
          - "**/platform/**"            # 排除特定目录

      # 单个文件 - 用于特殊文件
      - type: file
        path: src/core/version.cpp

      # 条件编译文件（通过 condition 实现，未来支持）
      # - type: file
      #   path: src/core/platform/linux.cpp
      #   condition: "UNIX AND NOT APPLE"

    # Include 目录
    include_directories:
      # PUBLIC: 对外暴露的头文件目录
      - path: include
        scope: PUBLIC

      # PRIVATE: 内部实现使用
      - path: src/core
        scope: PRIVATE

      # 第三方库头文件（如果有）
      # - path: third_party/json/include
      #   scope: PRIVATE

    # 编译选项
    compile_options:
      - option: "-Wall"                 # 所有警告
        scope: PRIVATE
      - option: "-Wextra"               # 额外警告
        scope: PRIVATE
      - option: "-Werror"               # 警告视为错误
        scope: PRIVATE
      - option: "-fPIC"                 # 位置无关代码
        scope: PUBLIC

    # 编译定义（宏）
    compile_definitions:
      - name: CORE_VERSION             # 版本号宏
        value: "\"2.1.3\""
        scope: PUBLIC

      - name: DEBUG_LOGGING            # 调试日志
        scope: PRIVATE

      # 条件宏（未来支持）
      # - name: PLATFORM_LINUX
      #   scope: PUBLIC
      #   condition: "UNIX AND NOT APPLE"

    # 链接系统库
    link_libraries:
      - name: pthread                  # POSIX 线程
        scope: PRIVATE
        type: system

      - name: m                        # 数学库
        scope: PRIVATE
        type: system

    # Target 属性
    properties:
      - name: ARCHIVE_OUTPUT_DIRECTORY # 输出目录
        value: "${CMAKE_BINARY_DIR}/lib"

  # ========== 共享库示例 ==========
  - name: utils
    type: shared_library

    sources:
      - type: glob
        pattern: src/utils/*.cpp
        recursive: false
        exclude:
          - "**/*_test.cpp"

    include_directories:
      - path: include/utils
        scope: PUBLIC
      - path: src/utils
        scope: PRIVATE

    # 共享库版本控制
    properties:
      - name: VERSION
        value: "${PROJECT_VERSION}"

      - name: SOVERSION               # 共享库 ABI 版本
        value: "2"

      - name: POSITION_INDEPENDENT_CODE
        value: "ON"

    # 导出符号
    compile_definitions:
      - name: UTILS_EXPORTS           # Windows DLL 导出
        scope: PRIVATE

    # 依赖核心库
    link_libraries:
      - name: core
        scope: PRIVATE
        type: internal                # 内部 target

  # ========== 可执行文件示例 ==========
  - name: app
    type: executable

    sources:
      - type: file
        path: src/main.cpp

      - type: glob
        pattern: src/app/*.cpp
        recursive: false

    include_directories:
      - path: src/app
        scope: PRIVATE

    # 链接内部库
    link_libraries:
      # 内部 target
      - name: core
        scope: PRIVATE
        type: internal

      - name: utils
        scope: PRIVATE
        type: internal

      # 通过 find_package 查找的库
      - name: Boost::program_options   # Boost 命令行解析
        scope: PRIVATE
        type: package
        find_package:
          package: Boost
          version: "1.70"
          required: true
          components:
            - program_options
            - filesystem
            - system

      # 系统库
      - name: dl                      # 动态链接库
        scope: PRIVATE
        type: system

    # 可执行文件专用选项
    compile_definitions:
      - name: APP_NAME
        value: "\"CompleteExample\""
        scope: PRIVATE

    properties:
      - name: RUNTIME_OUTPUT_DIRECTORY
        value: "${CMAKE_BINARY_DIR}/bin"

  # ========== 测试程序示例 ==========
  - name: tests
    type: executable

    sources:
      - type: glob
        pattern: tests/**/*_test.cpp
        recursive: true

    include_directories:
      - path: tests
        scope: PRIVATE

    link_libraries:
      # 链接要测试的库
      - name: core
        scope: PRIVATE
        type: internal

      # Google Test 框架（通过 FetchContent 或 find_package）
      - name: GTest::gtest_main
        scope: PRIVATE
        type: package
        find_package:
          package: GTest
          version: "1.10"
          required: false             # 可选依赖

      # 如果没找到，可以用 FetchContent（未来支持）
      # fetch_content:
      #   git_repository: "https://github.com/google/googletest.git"
      #   git_tag: "release-1.12.1"

    compile_definitions:
      - name: TESTING_MODE
        scope: PRIVATE

# ----------------------------------------------------------------------------
# 依赖管理（高级用法，未来支持）
# ----------------------------------------------------------------------------
# dependencies:
#   # 通过 find_package 查找
#   - name: Boost
#     type: find_package
#     find_package:
#       package: Boost
#       version: "1.70"
#       components: [filesystem, program_options]
#
#   # 通过 FetchContent 获取
#   - name: json
#     type: fetch_content
#     fetch_content:
#       git_repository: "https://github.com/nlohmann/json.git"
#       git_tag: "v3.11.2"

# ----------------------------------------------------------------------------
# 工具链配置（交叉编译等高级用法）
# ----------------------------------------------------------------------------
# toolchain:
#   preset: arm-linux-gnu            # 预设工具链
#   # 或自定义工具链文件
#   # file: cmake/toolchain-arm.cmake
#   # 或内联变量
#   # variables:
#   #   CMAKE_C_COMPILER: arm-linux-gnueabihf-gcc
#   #   CMAKE_CXX_COMPILER: arm-linux-gnueabihf-g++

# ----------------------------------------------------------------------------
# 元数据（自动生成）
# ----------------------------------------------------------------------------
metadata:
  generated_by: CMakeMakers
  version: 0.0.1
  # created_at: 2025-11-13T12:00:00Z
  # last_modified: 2025-11-13T15:30:00Z

# ============================================================================
# 典型使用场景总结
# ============================================================================
#
# 场景 1: 简单控制台应用
#   - 使用 console-app.yaml 模板
#   - 单个 executable target
#   - 最小配置
#
# 场景 2: 静态库项目
#   - 使用 static-lib.yaml 模板
#   - PUBLIC include 目录供使用者访问
#   - 适合内部库或嵌入式系统
#
# 场景 3: 共享库项目
#   - 使用 shared-lib.yaml 模板
#   - 设置 VERSION 和 SOVERSION
#   - 处理符号导出
#
# 场景 4: 多 target 复杂项目
#   - 参考本文件 (complete-example.yaml)
#   - 库 + 应用 + 测试
#   - Target 间依赖管理
#
# 场景 5: 跨平台项目
#   - 使用 condition 字段（未来支持）
#   - 不同平台不同的源文件和链接库
#
# 场景 6: 依赖外部库
#   - 使用 find_package 查找已安装的库
#   - 使用 FetchContent 自动下载依赖（未来支持）
#
# ============================================================================
